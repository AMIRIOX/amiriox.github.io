<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>CSAPP3e第二章(整数的运算) | Amiriox's Storage
</title>


  <meta name="description" content="世界再大 不过是些代价">



  <link rel="icon" href="/images/favicon-32x32.ico">



<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Lora:ital,wght@0,400;0,600;1,400&family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">

<link rel="stylesheet" href="/css/style.css">



<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true,
      tags: 'ams'
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>


<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Amiriox's Storage" type="application/atom+xml">
</head>
<body>
  <div class="newspaper-wrapper">
    <header class="newspaper-header">
  <div class="header-top">
    <div class="header-edition">Morning Edition</div>
    <div class="header-date">星期五, 一月 2, 2026</div>
    <button class="theme-toggle" aria-label="Toggle dark mode">
      <span class="toggle-sun">☀</span>
      <span class="toggle-moon">☾</span>
    </button>
  </div>
  
  <div class="masthead">
    <h1 class="newspaper-title">
      <a href="/">折鸦夜明け前</a>
    </h1>
    <p class="newspaper-motto">我们的同志在困难的时候，要看到成绩，要看到光明，要提高我们的勇气。</p>
  </div>
  
  <nav class="newspaper-nav">
    <div class="nav-divider"></div>
    <ul class="nav-menu">
      
        <li class="nav-item">
          <a href="/" class="nav-link">Home</a>
        </li>
      
        <li class="nav-item">
          <a href="/archives" class="nav-link">Archives</a>
        </li>
      
        <li class="nav-item">
          <a href="/categories" class="nav-link">Categories</a>
        </li>
      
        <li class="nav-item">
          <a href="/tags" class="nav-link">Tags</a>
        </li>
      
        <li class="nav-item">
          <a href="/about" class="nav-link">About</a>
        </li>
      
    </ul>
    <div class="nav-divider"></div>
  </nav>
</header>

    
    <main class="newspaper-content">
      
<div class="post-container">
  <article class="post-full">
    <header class="post-header">
      <div class="post-meta-top">
        
          <span class="post-category">组成原理</span>
        
        <time datetime="2025-01-25T12:11:15.000Z" class="post-date">
          星期六, 一月 25, 2025</time>
      </div>
      
      <h1 class="post-title">CSAPP3e第二章(整数的运算)</h1>
      
      
      
      <div class="post-byline">
        
          <span class="post-author">By 折鸦夜明け前</span>
        
        
          <span class="post-updated">Updated 十二月 31, 2025</span>
        
      </div>
    </header>
    
    <div class="post-divider"></div>
    
    <div class="post-content">
      <h1 id="整数的运算第二章-part2">整数的运算(第二章 Part2)</h1>
<h2 id="无符号数加法溢出">无符号数加法溢出</h2>
<p>无符号的数的加法溢出规则很简单, 单纯截取后 <span
class="math inline">\(w\)</span> 位, 或称对 <span
class="math inline">\(2^w\)</span> 取模。因此:</p>
<p><span class="math display">\[
x\ +_w^u\ y =
\begin{cases}
    x + y, &amp; x + y &lt; 2^w, \\
    x + y - 2^w, &amp; 2^w \leq x + y &lt; 2^{w+1}.
\end{cases}
\]</span></p>
<p>(<span class="math inline">\(+_w^u\)</span> 表示最多 <span
class="math inline">\(w\)</span> 位下的二进制无符号数加法。下文<span
class="math inline">\(+_w^t\)</span> 即 <span
class="math inline">\(w\)</span> 位补码加法)</p>
<h2 id="检验无符号数加法溢出">检验无符号数加法溢出</h2>
<p>若 <span class="math inline">\(s = x +_w^u y\)</span>, 当且仅当 <span
class="math inline">\(s &lt; x\)</span> （或等价地 <span
class="math inline">\(s &lt; y\)</span>） 时发生溢出。</p>
<p>(当然, 默认 <span class="math inline">\(x\)</span> 和 <span
class="math inline">\(y\)</span> 本身不会溢出, 即在 <span
class="math inline">\([0, UMax_w]\)</span> 的范围内)</p>
<p>原理易证, 分别证明充分性必要性即可, 注意利用以上公式</p>
<span id="more"></span>
<h2 id="补码加法溢出">补码加法溢出</h2>
<p>同样是截断,
但因为符号位的存在(还记得我们说的为什么补码最后被实际应用吗?
因为符号位本身是数值的一部分, 在计算中只要通过对 <span
class="math inline">\(2^w\)</span> 取模和截断就能运算出正确的数值,
类似一种环绕, 本质就是数论上的同余概念)显得略微复杂。</p>
<p><span class="math display">\[
x\ +_w^u\ y =
\begin{cases}
    x + y - 2^w, &amp; 2^{w-1} \leq x + y, \\
    x + y, &amp; -2^{w-1} \leq x + y &lt; 2^{w-1}, \\
    x + y + 2^w, &amp; x + y &lt; -2^{w-1}
\end{cases}
\]</span></p>
<p>多了就减, 少了就加, 数值都是 <span
class="math inline">\(2^w\)</span>。</p>
<p>推导就要用到 ”补码和无符号数的位级操作是一样的“。Formally:</p>
<p><span class="math display">\[
x +_w^t y = U2T(T2U(x) +_w^u T2U(y)
\]</span></p>
<p>(严格应写作 <span class="math inline">\(U2T_w\)</span>, 此处省略)
由于里面的两个 <span class="math inline">\(T2U\)</span> 只是可能地加上
<span class="math inline">\(2^w\)</span> (当且仅当最高符号位为 <span
class="math inline">\(1\)</span>), 而这两个带有 <span
class="math inline">\(2^w\)</span> 的项都被最外面无符号数加法的截断时的
<span class="math inline">\(\mod 2^w\)</span> 消除了,
所以最后其实就是</p>
<p><span class="math display">\[
x +_w^t y = U2T[(x + y)\mod 2^w].
\]</span></p>
<p>考虑 <span class="math inline">\(U2T\)</span>
的公式以及上篇文章经典的那张无符号数转补码的数值对应图,
分类讨论即可。</p>
<h2 id="检查补码加法溢出">检查补码加法溢出</h2>
<p>令 <span class="math inline">\(s = x +_w^t y\)</span>, 当且仅当 <span
class="math inline">\(x &gt; 0, y &gt; 0\)</span> 但 <span
class="math inline">\(s \leq 0\)</span> 或 <span class="math inline">\(x
&lt; 0, y &lt; 0\)</span> 但 <span class="math inline">\(s \geq
0\)</span> 时发生溢出。当然这里还是默认 <span class="math inline">\(x,
y\)</span> 本身在合理的 <span class="math inline">\(w\)</span>
位可表示的补码范围内。</p>
<h2 id="加法逆元">加法逆元</h2>
<p>感兴趣群论的知识可以去 b 站搜一下, 但实际上此处只是涉及一些概念,
浅尝辄止即可。</p>
<p>模数加法形成 <em>阿尔贝群 (Abelian group)</em> . 也就是说,
模数加法可交换、可结合。</p>
<blockquote>
<p>还记得那个梗吗？</p>
<p>判断孩子是否有数学天赋就问孩子为什么 1+ 2 = 2 + 1 ?</p>
<p>然后孩子说 因为整数集对加法构成阿尔贝群</p>
</blockquote>
<p>对于群的操作 “<span class="math inline">\(\cdot\)</span>”
和群中的元素 <span class="math inline">\(a\)</span>, <em>单位元</em>
<span class="math inline">\(e\)</span> 是群中唯一满足 $a e = e $
的元素。</p>
<p><em>逆元</em> 就是对于群中某元素 <span
class="math inline">\(a\)</span>， <span
class="math inline">\(a\)</span> 的逆元 <span
class="math inline">\(a^{-1}\)</span> 满足 <span class="math inline">\(a
\cdot a^{-1} = e\)</span></p>
<p>这个群的单位元是<del>欧元</del> <span
class="math inline">\(0\)</span> ,</p>
<p>而 无符号数 <span class="math inline">\(x\)</span>
的无符号数加法逆元满足:</p>
<p><span class="math display">\[
-_w^u\ x=
\begin{cases}
    x, &amp; x = 0, \\
    2^w - x, &amp; x &gt; 0.
\end{cases}
\]</span></p>
<p>而 补码 <span class="math inline">\(x\)</span>
的补码加法逆元满足:</p>
<p><span class="math display">\[
-_w^t\ x=
\begin{cases}
    x, &amp; x = TMin_w, \\
    -x, &amp; x &gt; TMin_w.
\end{cases}
\]</span></p>
<h2 id="乘法">乘法</h2>
<p>无符号数乘法直接按照模 <span class="math inline">\(2^w\)</span> 截断,
补码还是按照 <em>位级操作与无符号数相同原理</em>
先分别转换成无符号数再按照无符号乘法计算位模式,
最后转换为补码的数值。</p>
<h3 id="乘以-2-的幂次">乘以 2 的幂次</h3>
<p>一个常识是乘以 <span class="math inline">\(2^k\)</span> 就等价于左移
<span class="math inline">\(k\)</span>
位。虽然这一点显而易见也易于证明(通过公式定义即可),
但其实有一些可以说的地方, 例如 <span class="math inline">\(x \cdot 14 =
(x &lt;&lt; 3) + (x &lt;&lt; 2) + (x &lt;&lt; 1) = x \cdot (x &lt;&lt;
4) - (x &lt;&lt; 1)\)</span></p>
<p>具体来说, 如果一个表达式 <span class="math inline">\(x \cdot
k\)</span> 的 <span class="math inline">\(k\)</span> 能表示为 <span
class="math inline">\([(0...0)(1...1)(0...0)...(1...1)]\)</span>
即一段的 <span class="math inline">\(0\)</span> 和一段的 <span
class="math inline">\(1\)</span> 的序列，考虑一组从位置 <span
class="math inline">\(l\)</span> 到 位置 <span
class="math inline">\(r\)</span> 的 <span
class="math inline">\(1\)</span> 序列 <span class="math inline">\((l
\leq r)\)</span>, 这个位对乘积的影响可以表达为两个形式:(注意虽然 <span
class="math inline">\(l \leq r\)</span>
但其实二进制表示上下标大的在前面)</p>
<p><span class="math inline">\((x&lt;&lt;r) + (x&lt;&lt;(r-1)) + ... +
(x &lt;&lt; l)\)</span> 或</p>
<p><span class="math inline">\((x &lt;&lt; (r + 1)) - (x &lt;&lt;
l)\)</span></p>
<p>其实还可以想一想当 <span class="math inline">\(l, r\)</span>
为什么条件时第一种更好(左移和加减次数最少),
为什么条件时第二种更好。这也是 CSAPP 的习题之一。</p>
<h3 id="除以-2-的幂次">除以 2 的幂次</h3>
<p>你可能会想, 不就是右移 <span class="math inline">\(k\)</span>
位？但右移 <span class="math inline">\(k\)</span> 位计算的是 <span
class="math inline">\(\lfloor x / 2^k \rfloor\)</span>,
而一般的编程语言中除法是<strong>向零取整</strong>(即舍去小数点)而不是向下取整的(这点是程序设计课重灾区)。而大多数
OIer 或 ACMer 应该都很熟悉向上取整的方法: $a / b = (a + b - 1) / b
$。如果 <span class="math inline">\(a \mod b == 0\)</span> 那么 <span
class="math inline">\(b - 1\)</span> 会直接被向下取整舍掉,
否则就会令结果 <span class="math inline">\(+1\)</span>。</p>
<p>因此有 C 语言表达式
<code>(x &lt; 0 ? x + (1 &lt;&lt; k) - 1 : x) &gt;&gt; k</code> 计算数值
<span class="math inline">\(x / 2^k\)</span>。</p>
<p>这个向上取整的方法叫做 <em>偏置(biasing)</em> . 我们甚至还可以用右移
<span class="math inline">\(31\)</span> 位再 and
上掩码等各种手段判负从而优化掉条件语句 <del>这也是习题</del></p>

    </div>
    
    
      <footer class="post-footer">
        <div class="post-tags">
          <strong>Filed under:</strong>
          
            <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/" class="tag">#计算机科学</a>
          
            <a href="/tags/CSAPP-cmu15213/" class="tag">#CSAPP/cmu15213</a>
          
        </div>
      </footer>
    
    
    <div class="post-nav">
      
        <a href="/2025/01/26/2022-2023-2024/" class="post-nav-prev">
          <span class="nav-label">← Previous Story</span>
          <span class="nav-title">永远不要放弃战斗 -- 三年年终总结</span>
        </a>
      
      
      
        <a href="/2025/01/19/CSAPP-2025-01-19/" class="post-nav-next">
          <span class="nav-label">Next Story →</span>
          <span class="nav-title">CSAPP3e第二章(整数的表示)</span>
        </a>
      
    </div>
  </article>
  
  
    <aside class="post-sidebar">
  
    <div class="sidebar-toc">
      <h3 class="sidebar-title">Table of Contents</h3>
      <div class="toc-content">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B4%E6%95%B0%E7%9A%84%E8%BF%90%E7%AE%97%E7%AC%AC%E4%BA%8C%E7%AB%A0-part2"><span class="toc-number">1.</span> <span class="toc-text">整数的运算(第二章 Part2)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E7%AC%A6%E5%8F%B7%E6%95%B0%E5%8A%A0%E6%B3%95%E6%BA%A2%E5%87%BA"><span class="toc-number">1.1.</span> <span class="toc-text">无符号数加法溢出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E9%AA%8C%E6%97%A0%E7%AC%A6%E5%8F%B7%E6%95%B0%E5%8A%A0%E6%B3%95%E6%BA%A2%E5%87%BA"><span class="toc-number">1.2.</span> <span class="toc-text">检验无符号数加法溢出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E7%A0%81%E5%8A%A0%E6%B3%95%E6%BA%A2%E5%87%BA"><span class="toc-number">1.3.</span> <span class="toc-text">补码加法溢出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E8%A1%A5%E7%A0%81%E5%8A%A0%E6%B3%95%E6%BA%A2%E5%87%BA"><span class="toc-number">1.4.</span> <span class="toc-text">检查补码加法溢出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E6%B3%95%E9%80%86%E5%85%83"><span class="toc-number">1.5.</span> <span class="toc-text">加法逆元</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%98%E6%B3%95"><span class="toc-number">1.6.</span> <span class="toc-text">乘法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%98%E4%BB%A5-2-%E7%9A%84%E5%B9%82%E6%AC%A1"><span class="toc-number">1.6.1.</span> <span class="toc-text">乘以 2 的幂次</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%A4%E4%BB%A5-2-%E7%9A%84%E5%B9%82%E6%AC%A1"><span class="toc-number">1.6.2.</span> <span class="toc-text">除以 2 的幂次</span></a></li></ol></li></ol></li></ol>
      </div>
    </div>
  
  
  
    <div class="sidebar-author">
      <div class="author-avatar avatar-rounded">
        <img src="/images/icon.jpg" alt="Avatar">
      </div>
      <p class="author-name">折鸦夜明け前</p>
    </div>
  
  
  
    <div class="sidebar-social">
      <h3 class="sidebar-title">Follow</h3>
      <ul class="social-links">
        
          <li>
            <a href="https://github.com/amiriox" target="_blank" rel="noopener">GitHub</a>
          </li>
        
          <li>
            <a href="mailto:wumingyun2120@gmail.com" target="_blank" rel="noopener">E-Mail</a>
          </li>
        
          <li>
            <a href="https://www.zhihu.com/people/wu-ming-57-22-24" target="_blank" rel="noopener">Zhihu</a>
          </li>
        
          <li>
            <a href="https://space.bilibili.com/444947789" target="_blank" rel="noopener">Bilibili</a>
          </li>
        
      </ul>
    </div>
  
  
  
    <div class="sidebar-links">
      <h3 class="sidebar-title">友情链接</h3>
      <ul class="friend-links">
        
          <li>
            <a href="https://kawayww.com/" target="_blank" rel="noopener">柳下川的博客</a>
          </li>
        
          <li>
            <a href="https://www.overturn.cn/" target="_blank" rel="noopener">远视台</a>
          </li>
        
      </ul>
    </div>
  
</aside>

  
</div>

    </main>
    
    <footer class="newspaper-footer">
  <div class="footer-divider"></div>
  
  <div class="footer-content">
    <div class="footer-section">
      <h3>折鸦夜明け前</h3>
      <p>Est. 2020</p>
      
        <p class="footer-since">Since 2023</p>
      
    </div>
    
    
    <div class="footer-section">
      <h3>Follow Us</h3>
      <ul class="social-links">
        
          <li><a href="https://github.com/amiriox" target="_blank" rel="noopener">GitHub</a></li>
        
          <li><a href="mailto:wumingyun2120@gmail.com" target="_blank" rel="noopener">E-Mail</a></li>
        
          <li><a href="https://www.zhihu.com/people/wu-ming-57-22-24" target="_blank" rel="noopener">Zhihu</a></li>
        
          <li><a href="https://space.bilibili.com/444947789" target="_blank" rel="noopener">Bilibili</a></li>
        
      </ul>
    </div>
    
    
    
    <div class="footer-section">
      <h3>友情链接</h3>
      <ul class="footer-links">
        
          <li><a href="https://kawayww.com/" target="_blank" rel="noopener">柳下川的博客</a></li>
        
          <li><a href="https://www.overturn.cn/" target="_blank" rel="noopener">远视台</a></li>
        
      </ul>
    </div>
    
    
    <div class="footer-section">
      <h3>Navigation</h3>
      <ul class="footer-nav">
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/archives">Archives</a></li>
        
          <li><a href="/categories">Categories</a></li>
        
          <li><a href="/tags">Tags</a></li>
        
          <li><a href="/about">About</a></li>
        
      </ul>
    </div>
  </div>
  
  <div class="footer-bottom">
    <p>© 2025 The Daily Amiriox Makinohara. All Rights Reserved.</p>
    <p>
      
        Made with <span class="footer-icon icon-animated" style="color: #8b0000">⚂</span> · 
      
      Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> · Theme Newspepper
    </p>
  </div>
</footer>

  </div>
  
  <script src="/js/script.js"></script>

</body>
</html>
